// Copyright 2021 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package aaaaxy

import (
	"math"
)

type palData struct {
	size     int
	colors   []float32
	minDelta float64
}

func newPalData(c []float32) *palData {
	minDelta := float64(2.0)
	n := len(c) / 3
	for i := 0; i < n; i++ {
		if i >= 16 {
			// Protect only colors 0 to 15 from bad dithering.
			continue
		}
		for j := i + 1; j < n; j++ {
			delta := 0.0
			for k := 0; k < 3; k++ {
				d := math.Abs(float64(c[3*i+k]) - float64(c[3*j+k]))
				if d > delta {
					delta = d
				}
			}
			if delta > 0 && delta < minDelta {
				minDelta = delta
			}
		}
	}
	return &palData{
		size:     n,
		colors:   c,
		minDelta: minDelta,
	}
}

var palettes = map[string]*palData{
	// Monochrome.
	"mono": newPalData([]float32{
		0, 0, 0,
		1, 1, 1,
	}),

	// The original IBM CGA palette.
	"cga40l": newPalData([]float32{
		0, 0, 0,
		0, 2 / 3.0, 0,
		2 / 3.0, 0, 0,
		2 / 3.0, 1 / 3.0, 0,
	}),

	// The original IBM CGA palette at high intensity.
	"cga40h": newPalData([]float32{
		0, 0, 0,
		1 / 3.0, 1, 1 / 3.0,
		1, 1 / 3.0, 1 / 3.0,
		1, 1, 1 / 3.0,
	}),

	// The alternate IBM CGA palette.
	"cga41l": newPalData([]float32{
		0, 0, 0,
		0, 2 / 3.0, 2 / 3.0,
		2 / 3.0, 0, 2 / 3.0,
		2 / 3.0, 2 / 3.0, 2 / 3.0,
	}),

	// The alternate IBM CGA palette at high intensity.
	"cga41h": newPalData([]float32{
		0, 0, 0,
		1 / 3.0, 1, 1,
		1, 1 / 3.0, 1,
		1, 1, 1,
	}),

	// The "monochrome" IBM CGA palette.
	"cga5l": newPalData([]float32{
		0, 0, 0,
		0, 2 / 3.0, 2 / 3.0,
		2 / 3.0, 0, 0,
		2 / 3.0, 2 / 3.0, 2 / 3.0,
	}),

	// The "monochrome" IBM CGA palette at high intensity.
	"cga5h": newPalData([]float32{
		0, 0, 0,
		1 / 3.0, 1, 1,
		1, 1 / 3.0, 1 / 3.0,
		1, 1, 1,
	}),

	// The original IBM EGA palette.
	"ega": newPalData([]float32{
		0, 0, 0,
		0, 0, 2 / 3.0,
		0, 2 / 3.0, 0,
		0, 2 / 3.0, 2 / 3.0,
		2 / 3.0, 0, 0,
		2 / 3.0, 0, 2 / 3.0,
		2 / 3.0, 1 / 3.0, 0,
		2 / 3.0, 2 / 3.0, 2 / 3.0,
		1 / 3.0, 1 / 3.0, 1 / 3.0,
		1 / 3.0, 1 / 3.0, 1,
		1 / 3.0, 1, 1 / 3.0,
		1 / 3.0, 1, 1,
		1, 1 / 3.0, 1 / 3.0,
		1, 1 / 3.0, 1,
		1, 1, 1 / 3.0,
		1, 1, 1,
	}),

	// The original IBM VGA palette.
	"vga": newPalData([]float32{
		0, 0, 0,
		0, 0, 2 / 3.0,
		0, 2 / 3.0, 0,
		0, 2 / 3.0, 2 / 3.0,
		2 / 3.0, 0, 0,
		2 / 3.0, 0, 2 / 3.0,
		2 / 3.0, 1 / 3.0, 0,
		2 / 3.0, 2 / 3.0, 2 / 3.0,
		1 / 3.0, 1 / 3.0, 1 / 3.0,
		1 / 3.0, 1 / 3.0, 1,
		1 / 3.0, 1, 1 / 3.0,
		1 / 3.0, 1, 1,
		1, 1 / 3.0, 1 / 3.0,
		1, 1 / 3.0, 1,
		1, 1, 1 / 3.0,
		1, 1, 1,
		0, 0, 0,
		5 / 63.0, 5 / 63.0, 5 / 63.0,
		8 / 63.0, 8 / 63.0, 8 / 63.0,
		11 / 63.0, 11 / 63.0, 11 / 63.0,
		2 / 9.0, 2 / 9.0, 2 / 9.0,
		// 17 / 63.0, 17 / 63.0, 17 / 63.0,  // Too close to color 8.
		// 20 / 63.0, 20 / 63.0, 20 / 63.0,  // Too close to color 8.
		// 8 / 21.0, 8 / 21.0, 8 / 21.0,     // Too close to color 8.
		4 / 9.0, 4 / 9.0, 4 / 9.0,
		32 / 63.0, 32 / 63.0, 32 / 63.0,
		// 4 / 7.0, 4 / 7.0, 4 / 7.0,       // Too close to color 7.
		// 40 / 63.0, 40 / 63.0, 40 / 63.0, // Too close to color 7.
		// 5 / 7.0, 5 / 7.0, 5 / 7.0,       // Too close to color 7.
		50 / 63.0, 50 / 63.0, 50 / 63.0,
		8 / 9.0, 8 / 9.0, 8 / 9.0,
		1, 1, 1,
		0, 0, 1,
		16 / 63.0, 0, 1,
		31 / 63.0, 0, 1,
		47 / 63.0, 0, 1,
		1, 0, 1,
		1, 0, 47 / 63.0,
		1, 0, 31 / 63.0,
		1, 0, 16 / 63.0,
		1, 0, 0,
		1, 16 / 63.0, 0,
		1, 31 / 63.0, 0,
		1, 47 / 63.0, 0,
		1, 1, 0,
		47 / 63.0, 1, 0,
		31 / 63.0, 1, 0,
		16 / 63.0, 1, 0,
		0, 1, 0,
		0, 1, 16 / 63.0,
		0, 1, 31 / 63.0,
		0, 1, 47 / 63.0,
		0, 1, 1,
		0, 47 / 63.0, 1,
		0, 31 / 63.0, 1,
		0, 16 / 63.0, 1,
		31 / 63.0, 31 / 63.0, 1,
		13 / 21.0, 31 / 63.0, 1,
		47 / 63.0, 31 / 63.0, 1,
		55 / 63.0, 31 / 63.0, 1,
		1, 31 / 63.0, 1,
		1, 31 / 63.0, 55 / 63.0,
		1, 31 / 63.0, 47 / 63.0,
		1, 31 / 63.0, 13 / 21.0,
		1, 31 / 63.0, 31 / 63.0,
		1, 13 / 21.0, 31 / 63.0,
		1, 47 / 63.0, 31 / 63.0,
		1, 55 / 63.0, 31 / 63.0,
		1, 1, 31 / 63.0,
		55 / 63.0, 1, 31 / 63.0,
		47 / 63.0, 1, 31 / 63.0,
		13 / 21.0, 1, 31 / 63.0,
		31 / 63.0, 1, 31 / 63.0,
		31 / 63.0, 1, 13 / 21.0,
		31 / 63.0, 1, 47 / 63.0,
		31 / 63.0, 1, 55 / 63.0,
		31 / 63.0, 1, 1,
		31 / 63.0, 55 / 63.0, 1,
		31 / 63.0, 47 / 63.0, 1,
		31 / 63.0, 13 / 21.0, 1,
		5 / 7.0, 5 / 7.0, 1,
		7 / 9.0, 5 / 7.0, 1,
		6 / 7.0, 5 / 7.0, 1,
		58 / 63.0, 5 / 7.0, 1,
		1, 5 / 7.0, 1,
		1, 5 / 7.0, 58 / 63.0,
		1, 5 / 7.0, 6 / 7.0,
		1, 5 / 7.0, 7 / 9.0,
		1, 5 / 7.0, 5 / 7.0,
		1, 7 / 9.0, 5 / 7.0,
		1, 6 / 7.0, 5 / 7.0,
		1, 58 / 63.0, 5 / 7.0,
		1, 1, 5 / 7.0,
		58 / 63.0, 1, 5 / 7.0,
		6 / 7.0, 1, 5 / 7.0,
		7 / 9.0, 1, 5 / 7.0,
		5 / 7.0, 1, 5 / 7.0,
		5 / 7.0, 1, 7 / 9.0,
		5 / 7.0, 1, 6 / 7.0,
		5 / 7.0, 1, 58 / 63.0,
		5 / 7.0, 1, 1,
		5 / 7.0, 58 / 63.0, 1,
		5 / 7.0, 6 / 7.0, 1,
		5 / 7.0, 7 / 9.0, 1,
		0, 0, 4 / 9.0,
		1 / 9.0, 0, 4 / 9.0,
		2 / 9.0, 0, 4 / 9.0,
		1 / 3.0, 0, 4 / 9.0,
		4 / 9.0, 0, 4 / 9.0,
		4 / 9.0, 0, 1 / 3.0,
		4 / 9.0, 0, 2 / 9.0,
		4 / 9.0, 0, 1 / 9.0,
		4 / 9.0, 0, 0,
		4 / 9.0, 1 / 9.0, 0,
		4 / 9.0, 2 / 9.0, 0,
		4 / 9.0, 1 / 3.0, 0,
		4 / 9.0, 4 / 9.0, 0,
		1 / 3.0, 4 / 9.0, 0,
		2 / 9.0, 4 / 9.0, 0,
		1 / 9.0, 4 / 9.0, 0,
		0, 4 / 9.0, 0,
		0, 4 / 9.0, 1 / 9.0,
		0, 4 / 9.0, 2 / 9.0,
		0, 4 / 9.0, 1 / 3.0,
		0, 4 / 9.0, 4 / 9.0,
		0, 1 / 3.0, 4 / 9.0,
		0, 2 / 9.0, 4 / 9.0,
		0, 1 / 9.0, 4 / 9.0,
		2 / 9.0, 2 / 9.0, 4 / 9.0,
		17 / 63.0, 2 / 9.0, 4 / 9.0,
		1 / 3.0, 2 / 9.0, 4 / 9.0,
		8 / 21.0, 2 / 9.0, 4 / 9.0,
		4 / 9.0, 2 / 9.0, 4 / 9.0,
		4 / 9.0, 2 / 9.0, 8 / 21.0,
		4 / 9.0, 2 / 9.0, 1 / 3.0,
		4 / 9.0, 2 / 9.0, 17 / 63.0,
		4 / 9.0, 2 / 9.0, 2 / 9.0,
		4 / 9.0, 17 / 63.0, 2 / 9.0,
		4 / 9.0, 1 / 3.0, 2 / 9.0,
		4 / 9.0, 8 / 21.0, 2 / 9.0,
		4 / 9.0, 4 / 9.0, 2 / 9.0,
		8 / 21.0, 4 / 9.0, 2 / 9.0,
		1 / 3.0, 4 / 9.0, 2 / 9.0,
		17 / 63.0, 4 / 9.0, 2 / 9.0,
		2 / 9.0, 4 / 9.0, 2 / 9.0,
		2 / 9.0, 4 / 9.0, 17 / 63.0,
		2 / 9.0, 4 / 9.0, 1 / 3.0,
		2 / 9.0, 4 / 9.0, 8 / 21.0,
		2 / 9.0, 4 / 9.0, 4 / 9.0,
		2 / 9.0, 8 / 21.0, 4 / 9.0,
		2 / 9.0, 1 / 3.0, 4 / 9.0,
		2 / 9.0, 17 / 63.0, 4 / 9.0,
		20 / 63.0, 20 / 63.0, 4 / 9.0,
		22 / 63.0, 20 / 63.0, 4 / 9.0,
		8 / 21.0, 20 / 63.0, 4 / 9.0,
		26 / 63.0, 20 / 63.0, 4 / 9.0,
		4 / 9.0, 20 / 63.0, 4 / 9.0,
		4 / 9.0, 20 / 63.0, 26 / 63.0,
		4 / 9.0, 20 / 63.0, 8 / 21.0,
		4 / 9.0, 20 / 63.0, 22 / 63.0,
		4 / 9.0, 20 / 63.0, 20 / 63.0,
		4 / 9.0, 22 / 63.0, 20 / 63.0,
		4 / 9.0, 8 / 21.0, 20 / 63.0,
		4 / 9.0, 26 / 63.0, 20 / 63.0,
		4 / 9.0, 4 / 9.0, 20 / 63.0,
		26 / 63.0, 4 / 9.0, 20 / 63.0,
		8 / 21.0, 4 / 9.0, 20 / 63.0,
		22 / 63.0, 4 / 9.0, 20 / 63.0,
		20 / 63.0, 4 / 9.0, 20 / 63.0,
		20 / 63.0, 4 / 9.0, 22 / 63.0,
		20 / 63.0, 4 / 9.0, 8 / 21.0,
		20 / 63.0, 4 / 9.0, 26 / 63.0,
		20 / 63.0, 4 / 9.0, 4 / 9.0,
		20 / 63.0, 26 / 63.0, 4 / 9.0,
		20 / 63.0, 8 / 21.0, 4 / 9.0,
		20 / 63.0, 22 / 63.0, 4 / 9.0,
		0, 0, 16 / 63.0,
		4 / 63.0, 0, 16 / 63.0,
		8 / 63.0, 0, 16 / 63.0,
		4 / 21.0, 0, 16 / 63.0,
		16 / 63.0, 0, 16 / 63.0,
		16 / 63.0, 0, 4 / 21.0,
		16 / 63.0, 0, 8 / 63.0,
		16 / 63.0, 0, 4 / 63.0,
		16 / 63.0, 0, 0,
		16 / 63.0, 4 / 63.0, 0,
		16 / 63.0, 8 / 63.0, 0,
		16 / 63.0, 4 / 21.0, 0,
		16 / 63.0, 16 / 63.0, 0,
		4 / 21.0, 16 / 63.0, 0,
		8 / 63.0, 16 / 63.0, 0,
		4 / 63.0, 16 / 63.0, 0,
		0, 16 / 63.0, 0,
		0, 16 / 63.0, 4 / 63.0,
		0, 16 / 63.0, 8 / 63.0,
		0, 16 / 63.0, 4 / 21.0,
		0, 16 / 63.0, 16 / 63.0,
		0, 4 / 21.0, 16 / 63.0,
		0, 8 / 63.0, 16 / 63.0,
		0, 4 / 63.0, 16 / 63.0,
		8 / 63.0, 8 / 63.0, 16 / 63.0,
		10 / 63.0, 8 / 63.0, 16 / 63.0,
		4 / 21.0, 8 / 63.0, 16 / 63.0,
		2 / 9.0, 8 / 63.0, 16 / 63.0,
		16 / 63.0, 8 / 63.0, 16 / 63.0,
		16 / 63.0, 8 / 63.0, 2 / 9.0,
		16 / 63.0, 8 / 63.0, 4 / 21.0,
		16 / 63.0, 8 / 63.0, 10 / 63.0,
		16 / 63.0, 8 / 63.0, 8 / 63.0,
		16 / 63.0, 10 / 63.0, 8 / 63.0,
		16 / 63.0, 4 / 21.0, 8 / 63.0,
		16 / 63.0, 2 / 9.0, 8 / 63.0,
		16 / 63.0, 16 / 63.0, 8 / 63.0,
		2 / 9.0, 16 / 63.0, 8 / 63.0,
		4 / 21.0, 16 / 63.0, 8 / 63.0,
		10 / 63.0, 16 / 63.0, 8 / 63.0,
		8 / 63.0, 16 / 63.0, 8 / 63.0,
		8 / 63.0, 16 / 63.0, 10 / 63.0,
		8 / 63.0, 16 / 63.0, 4 / 21.0,
		8 / 63.0, 16 / 63.0, 2 / 9.0,
		8 / 63.0, 16 / 63.0, 16 / 63.0,
		8 / 63.0, 2 / 9.0, 16 / 63.0,
		8 / 63.0, 4 / 21.0, 16 / 63.0,
		8 / 63.0, 10 / 63.0, 16 / 63.0,
		11 / 63.0, 11 / 63.0, 16 / 63.0,
		4 / 21.0, 11 / 63.0, 16 / 63.0,
		13 / 63.0, 11 / 63.0, 16 / 63.0,
		5 / 21.0, 11 / 63.0, 16 / 63.0,
		16 / 63.0, 11 / 63.0, 16 / 63.0,
		16 / 63.0, 11 / 63.0, 5 / 21.0,
		16 / 63.0, 11 / 63.0, 13 / 63.0,
		16 / 63.0, 11 / 63.0, 4 / 21.0,
		16 / 63.0, 11 / 63.0, 11 / 63.0,
		16 / 63.0, 4 / 21.0, 11 / 63.0,
		16 / 63.0, 13 / 63.0, 11 / 63.0,
		16 / 63.0, 5 / 21.0, 11 / 63.0,
		16 / 63.0, 16 / 63.0, 11 / 63.0,
		5 / 21.0, 16 / 63.0, 11 / 63.0,
		13 / 63.0, 16 / 63.0, 11 / 63.0,
		4 / 21.0, 16 / 63.0, 11 / 63.0,
		11 / 63.0, 16 / 63.0, 11 / 63.0,
		11 / 63.0, 16 / 63.0, 4 / 21.0,
		11 / 63.0, 16 / 63.0, 13 / 63.0,
		11 / 63.0, 16 / 63.0, 5 / 21.0,
		11 / 63.0, 16 / 63.0, 16 / 63.0,
		11 / 63.0, 5 / 21.0, 16 / 63.0,
		11 / 63.0, 13 / 63.0, 16 / 63.0,
		11 / 63.0, 4 / 21.0, 16 / 63.0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
		// 0, 0, 0,
	}),
}
